var new_tab_editor=function(){"use strict";return{PREFIX:"newtabeditor",file_id:null,editor:null,info:document.getElementById("info"),files:[],loadFiles:function(){chrome.storage.sync.get(null,function(e){new_tab_editor.files=e;var t=Object.keys(e);t=t.reduce(function(t,n){if(0!==n.indexOf(new_tab_editor.PREFIX))return t;var i=e[n].name||"empty name";return t.files.push({id:n,name:i,class:e[n].name==new_tab_editor.file_id?"active":""}),t},{files:[]});var n=Mustache.render(document.getElementById("template").innerHTML,t);document.getElementById("files").innerHTML=n;document.querySelectorAll(".file").forEach(function(e){e.onclick||(e.onclick=new_tab_editor.loadFile,e.ondblclick=new_tab_editor.renameFile)});document.querySelectorAll(".close").forEach(function(e){e.onclick=new_tab_editor.deleteFile})})},init:function(){new_tab_editor.editor=CodeMirror.fromTextArea(document.getElementById("editor"),{lineNumbers:!0,lineWrapping:!0}),new_tab_editor.loadFiles()},newFile:function(e){new_tab_editor.prefix,(+new Date).toString()},saveFile:function(){console.log("saved");try{var e={};e[new_tab_editor.file_id]={name:"",value:new_tab_editor.editor.getValue()},chrome.storage.sync.set(e)}catch(e){alert(e.message)}},timeout_id:null,keyup:function(){-1!=new_tab_editor.timeout_id&&clearTimeout(new_tab_editor.timeout_id),new_tab_editor.calculateAndShowLength(),new_tab_editor.timeout_id=setTimeout(new_tab_editor.saveFile,3e3)},calculateAndShowLength:function(){new_tab_editor.info.innerHTML="Length: "+new_tab_editor.editor.getValue().length},loadFile:function(e){e=e.srcElement.parentElement;var t=document.getElementById(new_tab_editor.file_id);t&&t.classList.toggle("active"),new_tab_editor.file_id=e.id,chrome.storage.sync.get(new_tab_editor.file_id,function(e){new_tab_editor.editor.setValue(e[new_tab_editor.file_id].value),new_tab_editor.editor.on("keyup",new_tab_editor.keyup),new_tab_editor.calculateAndShowLength()}),e.classList.toggle("active")},deleteFile:function(e){console.log("deleting file")},renameFile:function(e){e.srcElement.contentEditable=!0}}}();window.onload=function(){new_tab_editor.init()};